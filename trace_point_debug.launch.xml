<launch>
    <arg name="use_param" default="false" />
    <arg name="use_sim_time" default="false" />
    <arg name="preload_libs" default="libagnocast_heaphook.so:$(env LD_PRELOAD '')" />

    <node pkg="agnocast_sample_application" exec="no_rclcpp_talker" name="no_rclcpp_talker_node" output="screen">
        <env name="LD_PRELOAD" value="$(var preload_libs)" />
        <param name="use_sim_time" value="$(var use_sim_time)" />
    </node>

    <node pkg="agnocast_sample_application" exec="no_rclcpp_listener" name="no_rclcpp_listener_node" output="screen" unless="$(var use_param)">
        <env name="LD_PRELOAD" value="$(var preload_libs)" />
        <param name="use_sim_time" value="$(var use_sim_time)" />
    </node>

    <node pkg="agnocast_sample_application" exec="no_rclcpp_listener" name="no_rclcpp_listener_node" output="screen" if="$(var use_param)">
        <env name="LD_PRELOAD" value="$(var preload_libs)" />
        <param name="use_sim_time" value="$(var use_sim_time)" />
        <param name="topic_name" value="/custom_topic" />
        <param name="qos.queue_size" value="10" />
        <param name="qos_overrides./custom_topic.subscription.durability" value="transient_local" />
    </node>

    <node pkg="agnocast_sample_application" exec="no_rclcpp_take_listener" name="no_rclcpp_take_listener_node" output="screen">
        <env name="LD_PRELOAD" value="$(var preload_libs)" />
        <param name="use_sim_time" value="$(var use_sim_time)" />
    </node>
</launch>